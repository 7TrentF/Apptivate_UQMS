@{
    ViewData["Title"] = "Submit Administrative Query";
    int queryTypeId = ViewBag.QueryTypeID;
    var categories = ViewBag.QueryCategories as ICollection<Apptivate_UQMS_WebApp.Models.QueryModel.QueryCategory>;
    var studentDetail = ViewBag.StudentDetail as Apptivate_UQMS_WebApp.Models.Account.StudentDetail;
}


<h1>Submit an Administrative Query</h1>

<div class="student-details-card">
    <h2>Student Details</h2>
    <p><strong>ID:</strong> @studentDetail.StudentID</p>
    <p><strong>Department:</strong> @studentDetail.Department</p>
    <p><strong>Course:</strong> @studentDetail.Course</p>
    <p><strong>Year:</strong> @studentDetail.Year</p>
</div>



<div class="query-form-section">
    <h2>Create a Query</h2>
    <p>Write and address new queries and issues</p>
    <form class="query-form" asp-action="SubmitAdministrativeQuery" method="post" enctype="multipart/form-data">
        <input type="hidden" name="QueryTypeID" value="@queryTypeId" />

        <label for="query-category">Query Category</label>
        <select id="query-category" name="CategoryID">
            @foreach (var category in categories)
            {
                <option value="@category.CategoryID">@category.CategoryName</option>
            }
        </select>

        <label for="ticket-body">Ticket Body</label>
        <textarea id="ticket-body" name="Description" rows="4" maxlength="150" placeholder="Type query here..." required></textarea>
        <p id="charCount" class="character-limit">Maximum 150 characters</p>

        @if (ViewData.ModelState["Description"]?.Errors.Count > 0)
        {
            <div class="error-message">
                @ViewData.ModelState["Description"]?.Errors[0].ErrorMessage
            </div>
        }


        <div class="media-upload">
            <label for="media-upload" class="upload-btn">Browse files</label>
            <input type="file" id="media-upload" name="UploadedFile" style="display: block;" />
            <p class="file-types">Only support .jpg, .png, .pdf, and .zip files</p>
        </div>

        <button type="submit">Submit</button>
    </form>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var ticketBody = document.getElementById('ticket-body');
        var charCount = document.getElementById('charCount');

        ticketBody.addEventListener('input', function () {
            var remaining = 150 - ticketBody.value.length;
            charCount.innerHTML = `Maximum 150 characters.<br>Remaining: ${remaining} characters`;
        });
    });
</script>