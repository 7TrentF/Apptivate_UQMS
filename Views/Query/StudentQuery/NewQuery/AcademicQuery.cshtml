@{
    ViewData["Title"] = "Submit Academic Query";
    int queryTypeId = ViewBag.QueryTypeID;
    var categories = ViewBag.QueryCategories as ICollection<Apptivate_UQMS_WebApp.Models.QueryModel.QueryCategory>;
    var studentDetail = ViewBag.StudentDetail as Apptivate_UQMS_WebApp.Models.Account.StudentDetail;
}

<h1>Submit an Academic Query</h1>

<div class="student-details-card">
    <h2>Student Details</h2>
    <p><strong>ID:</strong> @studentDetail.StudentID</p>
    <p><strong>Department:</strong> @studentDetail.Department</p>
    <p><strong>Course:</strong> @studentDetail.Course</p>
    <p><strong>Year:</strong> @studentDetail.Year</p>
</div>
<div class="query-form-section">
    <h2>Create a Query</h2>
    <p class="form-description">Submit your queries or issues, and we will address them promptly.</p>

    <form class="query-form" asp-action="SubmitAcademicQuery" method="post" enctype="multipart/form-data">
        <input type="hidden" name="QueryTypeID" value="@queryTypeId" />

        <!-- Query Category Selection -->
        <div class="form-group">
            <label for="query-category">Query Category</label>
            <select id="query-category" name="CategoryID" class="custom-select">
                @foreach (var category in categories)
                {
                    <option value="@category.CategoryID">@category.CategoryName</option>
                }
            </select>
        </div>

        <!-- Ticket Body -->
        <div class="form-group">
            <label for="ticket-body">Ticket Body</label>
            <textarea id="ticket-body" name="Description" rows="4" maxlength="150" placeholder="Type your query here..." required class="form-control"></textarea>
            <p id="charCount" class="character-limit">Maximum 150 characters</p>

            @if (ViewData.ModelState["Description"]?.Errors.Count > 0)
            {
                <div class="error-message">
                    @ViewData.ModelState["Description"]?.Errors[0].ErrorMessage
                </div>
            }
        </div>

        <!-- File Upload Section -->
        <div class="media-upload">
            <label for="media-upload" class="upload-btn">Browse files</label>
            <input type="file" id="media-upload" name="UploadedFile" style="display: none;" />
            <p class="file-types">Supported formats: .jpg, .png, .pdf, .zip</p>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary btn-submit">Submit Query</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var ticketBody = document.getElementById('ticket-body');
        var charCount = document.getElementById('charCount');

        ticketBody.addEventListener('input', function () {
            var remaining = 150 - ticketBody.value.length;
            charCount.innerHTML = `Maximum 150 characters.<br>Remaining: ${remaining} characters`;
        });
    });
</script>
